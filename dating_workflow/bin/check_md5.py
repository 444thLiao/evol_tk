"""
check the md5sum generated by ncbi-genome-download

"""

import os
from glob import glob
from os.path import join, exists, basename, dirname, isdir, expanduser
from subprocess import check_output
import multiprocessing as mp
import click
from Bio import SeqIO
from tqdm import tqdm

HOME=os.getenv("HOME")

metadata = f"{HOME}/.cache/ncbi-genome-download/genbank_bacteria_assembly_summary.txt"

def get_cmd(cmd):
    check_output(cmd, shell=True,
               stderr=open('/dev/null', 'w'),
               )


def main(indir):
    
    all_dir = [_
               for _ in glob(join(indir, '**', 'GC*','*.fna.gz'),
                             recursive=True)
               ]
    tqdm.write("check md5sum")
    for p_dir in tqdm(all_dir):
        p_dir = dirname(p_dir)
        
        fna_file = glob(join(p_dir, '*.fna.gz'))[0]
        if not exists(new_fna):
            get_cmd(f'gunzip -d -c {fna_file} > {new_fna}')


@click.command(help="""
accept input directory to iterate its descending directory and check their md5sum
""")
@click.option("-i", "indir", help="input directory [./genbank]", default="./genbank", )
def cli(indir, odir, ):
    if not exists(indir):
        raise IOError("input dir doesn't exist")
    if not exists(odir):
        os.makedirs(odir, exist_ok=True)

if __name__ == "__main__":
    cli()


